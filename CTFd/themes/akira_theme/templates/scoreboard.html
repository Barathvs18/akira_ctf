{% extends "base.html" %}

{% block stylesheets %}

<style>
	/* ================================
   Scoreboard â€“ Japanese Glass Theme
   ================================ */

	/* Header */
	.jumbotron {
		background: transparent;
		padding-top: 90px;
		padding-bottom: 40px;
	}

	.jumbotron h1 {
		font-family: 'Abril Fatface', serif;
		letter-spacing: 0.08em;
		color: #f8fafc;
		text-align: center;
	}

	/* Spinner */
	.spinner {
		color: #ff6f91;
		text-shadow: 0 0 12px rgba(255, 111, 145, 0.6);
	}

	/* Score graph container */
	#score-graph {
		background: rgba(15, 15, 25, 0.65);
		backdrop-filter: blur(16px) saturate(150%);
		-webkit-backdrop-filter: blur(16px) saturate(150%);
		border-radius: 18px;
		border: 1px solid rgba(255, 255, 255, 0.12);
		box-shadow: 0 10px 40px rgba(0, 0, 0, 0.7);
		margin-bottom: 30px;
		min-height: 280px;
	}

	/* Scoreboard table */
	#scoreboard .table {
		background: rgba(15, 15, 25, 0.65);
		backdrop-filter: blur(16px);
		border-radius: 18px;
		overflow: hidden;
		color: #e5e7eb;
	}

	/* Table header */
	#scoreboard .table thead {
		background: rgba(255, 255, 255, 0.06);
	}

	#scoreboard .table thead td {
		color: #f8fafc;
		font-weight: 600;
	}

	/* Table rows */
	#scoreboard .table-striped tbody tr:nth-of-type(odd) {
		background: rgba(255, 255, 255, 0.03);
	}

	#scoreboard .table td,
	#scoreboard .table th {
		border-color: rgba(247, 247, 247, 0.08);
	}

	/* Place number */
	#scoreboard th[scope="row"] {
		color: #f5f5f5;
		font-weight: 600;
	}

	/* Links */
	#scoreboard a {
		color: #fcf9f9;
		transition: all 0.2s ease;
	}

	#scoreboard a:hover {
		text-decoration: none;
		text-shadow: 0 0 10px rgba(255, 111, 145, 0.6);
	}

	/* Official badge */
	#scoreboard .badge-primary {
		background: rgba(255, 111, 145, 0.25) !important;
		border: 1px solid rgba(255, 111, 145, 0.45);
	}

	/* Error alert glass fix */
	.alert {
		background: rgba(255, 50, 80, 0.2);
		border: 1px solid rgba(255, 50, 80, 0.4);
		color: #fff;
	}

	/* Force white text on ECharts graph */
	#score-graph text,
	#score-graph tspan,
	#score-graph text[fill],
	#score-graph tspan[fill],
	#score-graph [class*="echarts"] text,
	#score-graph [class*="echarts"] tspan,
	#score-graph canvas+div text,
	#score-graph canvas+div tspan {
		fill: #ffffff !important;
		color: #ffffff !important;
	}

	/* Target ECharts tooltip and legend text */
	#score-graph .echarts-tooltip,
	#score-graph .echarts-tooltip * {
		color: #ffffff !important;
	}

	/* Additional specificity for SVG text elements */
	div#score-graph text,
	div#score-graph tspan {
		fill: #ffffff !important;
	}
</style>
{% endblock %}


{% block content %}
<div class="jumbotron">
	<div class="container">
		<h1>Scoreboard</h1>
	</div>
</div>
<div class="container" style="color: white; padding: 30px;">
	{% include "components/errors.html" %}

	<div id="score-graph" class="row d-flex align-items-center">
		<div class="col-md-12 text-center">
			<i class="fas fa-circle-notch fa-spin fa-3x fa-fw spinner"></i>
		</div>
	</div>
	<div>

		{% cache 60, CacheKeys.PUBLIC_SCOREBOARD_TABLE %}
		{% if standings %}
	</div>
	<div id="scoreboard" class="row">
		<div class="col-md-12">
			<table class="table table-striped">
				<thead>
					<tr>
						<td scope="col" width="10px"><b>Place</b></td>
						<td scope="col"><b>{{ get_mode_as_word(capitalize=True) }}</b></td>
						<td scope="col"><b>Score</b></td>
					</tr>
				</thead>
				<tbody style="color: white;">
					{% for standing in standings %}
					<tr>
						<th scope="row" class="text-center">{{ loop.index }}</th>
						<td>
							<a href="{{ generate_account_url(standing.account_id) }}">
								{{ standing.name | truncate(50) }}

								{% if standing.oauth_id %}
								{% if Configs.user_mode == 'teams' %}
								<a href="https://majorleaguecyber.org/t/{{ standing.name }}">
									<span class="badge badge-primary">Official</span>
								</a>
								{% elif Configs.user_mode == 'users' %}
								<a href="https://majorleaguecyber.org/u/{{ standing.name }}">
									<span class="badge badge-primary">Official</span>
								</a>
								{% endif %}
								{% endif %}
							</a>
						</td>
						<td>{{ standing.score }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
	{% endif %}
	{% endcache %}
</div>
{% endblock %}

{% block scripts %}
<script defer src="{{ url_for('views.themes', path='js/echarts.bundle.js') }}"></script>
{% endblock %}

{% block entrypoint %}
<script defer src="{{ url_for('views.themes', path='js/pages/scoreboard.js') }}"></script>
<script>
	// Force white text colors on the score graph after chart loads
	document.addEventListener('DOMContentLoaded', function () {
		setTimeout(function () {
			var chartDom = document.querySelector('#score-graph');
			if (chartDom && typeof echarts !== 'undefined') {
				var chart = echarts.getInstanceByDom(chartDom);
				if (chart) {
					var currentOpt = chart.getOption();
					chart.setOption({
						title: { textStyle: { color: '#ffffff' } },
						legend: { textStyle: { color: '#ffffff' } },
						xAxis: [{ axisLabel: { color: '#ffffff' }, axisLine: { lineStyle: { color: '#ffffff' } } }],
						yAxis: [{ axisLabel: { color: '#ffffff' }, axisLine: { lineStyle: { color: '#ffffff' } }, splitLine: { lineStyle: { color: 'rgba(255, 255, 255, 0.2)' } } }],
						dataZoom: [{ textStyle: { color: '#ffffff' } }]
					});
				}
			}
		}, 500);
	});
</script>
{% endblock %}